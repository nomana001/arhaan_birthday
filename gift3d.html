<!-- gift3d.html (mobile-friendly) -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Gift for Arhaan ‚Äî 3D Kitty üéÅüê±</title>
<style>
  :root{
    --bg1:#fffaf6; --accent:#ff6fa8; --muted:#6b4a5a;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
  body{background:linear-gradient(180deg,#fffaf6,#fff6f0);display:flex;align-items:center;justify-content:center;padding:12px;}
  #wrap{width:100%;max-width:1080px;height:88vh;background:linear-gradient(180deg,#ffffff,#fff7f9);border-radius:18px;box-shadow:0 24px 60px rgba(30,10,40,0.08);position:relative;overflow:hidden;}
  header{padding:14px 16px;color:var(--accent);font-weight:800;font-size:17px}
  .sub{padding:0 16px;color:var(--muted);font-size:13px}
  #canvas-holder{position:absolute;left:12px;right:12px;top:92px;bottom:12px;border-radius:12px;overflow:hidden}
  canvas{width:100%;height:100%;display:block}

  /* speech bubble */
  .bubble{
    position:absolute;
    max-width:76%;
    min-width:160px;
    background:linear-gradient(180deg,#fff,#fff6f8);
    box-shadow:0 10px 30px rgba(30,10,30,0.08);
    border-radius:14px;padding:10px 12px;color:#3b2a35;font-weight:700;line-height:1.25;z-index:30;transform-origin:left bottom;
    font-size:14px;
  }
  .bubble::after{
    content:"";position:absolute;left:18px;bottom:-10px;width:0;height:0;border-left:9px solid transparent;border-right:9px solid transparent;border-top:10px solid #fff6f8;
  }

  /* small help text */
  .ui{
    position:absolute;left:14px;top:14px;z-index:40;
  }
  .go-btn{display:inline-block;padding:10px 14px;border-radius:20px;background:linear-gradient(90deg,#ff7aa8,#ff4f8f);color:white;text-decoration:none;font-weight:800;margin-top:8px}

  @media (min-width:900px){
    .bubble{font-size:16px; max-width:44%;}
  }
</style>
</head>
<body>
  <div id="wrap" role="main" aria-label="Interactive gift with 3D cat">
    <div class="ui">
      <header>Here's something special ‚Äî tap the gift üéÅ</header>
      <div class="sub">Tap near the kitty to make it jump & meow. The kitty will "say" each line ‚Äî tap the gift to play the chase. Mobile-first design.</div>
    </div>

    <div id="canvas-holder"><canvas id="three-canvas" aria-label="3D scene"></canvas></div>

    <!-- speech bubble (positioned by JS) -->
    <div id="bubble" class="bubble" style="display:none">Hello</div>
  </div>

  <script type="module">
    import * as THREE from 'https://unpkg.com/three@0.152.2/build/three.module.js';
    import { OrbitControls } from 'https://unpkg.com/three@0.152.2/examples/jsm/controls/OrbitControls.js';
    import { GLTFLoader } from 'https://unpkg.com/three@0.152.2/examples/jsm/loaders/GLTFLoader.js';
    import { DRACOLoader } from 'https://unpkg.com/three@0.152.2/examples/jsm/loaders/DRACOLoader.js';

    // ---------- USER: replace this with your GitHub-Pages URL after upload ----------
    const CAT_MODEL_URL = 'https://yourusername.github.io/happybirthday-arhaan/cute_spooky_cat.glb';
    // ------------------------------------------------------------------------------

    const MEOW_URL = 'https://cdn.pixabay.com/download/audio/2021/08/08/audio_7e3a3d6e17.mp3?filename=cartoon-meow-57110.mp3';

    // Scene setup
    const canvas = document.getElementById('three-canvas');
    const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:true });
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.shadowMap.enabled = true;

    const scene = new THREE.Scene();
    scene.background = null;

    const camera = new THREE.PerspectiveCamera(40, 1, 0.1, 1000);
    camera.position.set(0, 1.4, 3.0);

    // lights (soft, pleasant)
    const hemi = new THREE.HemisphereLight(0xffffff, 0x8888ff, 0.55); scene.add(hemi);
    const dir = new THREE.DirectionalLight(0xffffff, 0.8); dir.position.set(6,10,6); scene.add(dir);
    const amb = new THREE.AmbientLight(0xffffff, 0.18); scene.add(amb);

    // ground
    const ground = new THREE.Mesh(new THREE.PlaneGeometry(40,40), new THREE.MeshStandardMaterial({color:0xffffff,transparent:true,opacity:0.02}));
    ground.rotation.x = -Math.PI/2; ground.position.y = -0.01; scene.add(ground);

    // camera controls: only enabled for large screens for testing / debugging
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enablePan = false;
    controls.enableRotate = false; // lock rotation for consistent mobile experience
    controls.enableZoom = true;
    controls.minDistance = 1.5; controls.maxDistance = 6;
    controls.update();

    // small gift box
    const giftGroup = new THREE.Group(); scene.add(giftGroup);
    const boxMat = new THREE.MeshStandardMaterial({color:0xff6fa8, metalness:0.25, roughness:0.45});
    const box = new THREE.Mesh(new THREE.BoxGeometry(0.8,0.6,0.8), boxMat); box.position.y = 0.3; giftGroup.add(box);
    const lid = new THREE.Mesh(new THREE.BoxGeometry(0.82,0.12,0.82), new THREE.MeshStandardMaterial({color:0xff9dbb, metalness:0.1, roughness:0.4}));
    lid.position.y = 0.66; giftGroup.add(lid);
    const ribbonMat = new THREE.MeshStandardMaterial({color:0xffffff, metalness:0.1, roughness:0.3});
    const strip1 = new THREE.Mesh(new THREE.BoxGeometry(0.12,0.62,0.9), ribbonMat); strip1.position.y=0.32; giftGroup.add(strip1);
    const strip2 = strip1.clone(); strip2.rotation.y = Math.PI/2; strip2.position.y = 0.32; giftGroup.add(strip2);

    giftGroup.position.set(0.9,0,0);

    // kitty group
    const catGroup = new THREE.Group(); scene.add(catGroup);
    catGroup.position.set(-0.9,0,0);

    const dracoLoader = new DRACOLoader();
    dracoLoader.setDecoderPath('https://unpkg.com/three@0.152.2/examples/js/libs/draco/');
    const loader = new GLTFLoader();
    loader.setDRACOLoader(dracoLoader);

    let catModel = null, mixer = null, actions = {}, clock = new THREE.Clock();

    loader.load(CAT_MODEL_URL, (gltf)=>{
      const model = gltf.scene || gltf.scenes[0];
      model.traverse(node => { if(node.isMesh){ node.castShadow=true; node.receiveShadow=true; }});
      // normalize, center, scale
      const bbox = new THREE.Box3().setFromObject(model);
      const center = bbox.getCenter(new THREE.Vector3());
      model.position.x += -center.x;
      model.position.z += -center.z;
      const height = bbox.getSize(new THREE.Vector3()).y;
      const desired = 1.0;
      const s = desired / (height || 1);
      model.scale.setScalar(s * 0.9);
      model.position.y += -bbox.min.y * s;

      catGroup.add(model);
      catModel = model;

      if(gltf.animations && gltf.animations.length){
        mixer = new THREE.AnimationMixer(model);
        gltf.animations.forEach(clip => { actions[clip.name] = mixer.clipAction(clip); });
        // play idle if exists
        const idle = actions['Idle'] || actions['idle'] || Object.values(actions)[0];
        if(idle) idle.play();
      }
    }, undefined, (err)=>{
      console.warn('Model failed to load:', err);
      // fallback: simple placeholder cat
      const body = new THREE.Mesh(new THREE.SphereGeometry(0.36,24,24), new THREE.MeshStandardMaterial({color:0xffffff}));
      body.position.y = 0.4; catGroup.add(body);
      catModel = catGroup;
    });

    // DOM bubble
    const bubble = document.getElementById('bubble');
    function showBubble(text){
      bubble.style.display = 'block';
      bubble.innerHTML = text;
      positionBubbleAboveCat();
    }
    function hideBubble(){ bubble.style.display = 'none'; }

    // messages sequence
    const messages = [
      "Here's something special for you ‚Äî click here üéÅ",
      "Oops you missed it, try again meri jaan üíã",
      "Ok ok now it's final ‚Äî click here üòú",
      "I am the gift ‚Äî what other thing you want? another woman? üïµÔ∏è‚Äç‚ôÄÔ∏èüòè",
      "Ahh, you couldn't have another woman, so it's me üòéüíñ",
      "After all the fun... here's your birthday wish üéÇ"
    ];
    let attempt = 0, giftOpened=false;

    // position bubble next to cat head (project 3D to 2D)
    function positionBubbleAboveCat(){
      if(!catModel) return;
      const worldPos = new THREE.Vector3();
      catModel.getWorldPosition(worldPos);
      worldPos.y += 0.8;
      const vector = worldPos.project(camera);
      const holderRect = document.getElementById('wrap').getBoundingClientRect();
      const x = (vector.x * 0.5 + 0.5) * holderRect.width;
      const y = ( -vector.y * 0.5 + 0.5) * holderRect.height;
      // place bubble with boundaries
      const left = Math.min(holderRect.width - 20, Math.max(12, x - 30));
      const top = Math.max(12, y - 140);
      bubble.style.left = left + 'px';
      bubble.style.top = top + 'px';
    }

    // kitty jump + cartoon meow
    const audio = new Audio(MEOW_URL);
    audio.preload = 'auto';
    function kittyJump(){
      audio.currentTime = 0; audio.play().catch(()=>{});
      if(actions && (actions['Jump'] || actions['jump'])){
        const a = actions['Jump'] || actions['jump']; a.reset().play().setLoop(THREE.LoopOnce,1).onFinish(()=>a.stop());
      } else {
        if(catModel){
          // simple bounce
          const s0 = catGroup.scale.clone ? catGroup.scale.clone() : new THREE.Vector3(1,1,1);
          const t0 = performance.now(), dur = 520;
          (function bounce(now){
            const p = Math.min(1,(now-t0)/dur);
            const s = 1 + Math.sin(p*Math.PI)*0.16;
            catGroup.scale.set(s,s,s);
            if(p < 1) requestAnimationFrame(bounce);
            else catGroup.scale.copy(s0);
          })(performance.now());
        }
      }
    }

    // handle pointer for both mouse & touch
    const raycaster = new THREE.Raycaster();
    const pointer = new THREE.Vector2();

    function onPointerDown(ev){
      const rect = renderer.domElement.getBoundingClientRect();
      const clientX = ev.touches ? ev.touches[0].clientX : ev.clientX;
      const clientY = ev.touches ? ev.touches[0].clientY : ev.clientY;
      pointer.x = ((clientX - rect.left) / rect.width) * 2 - 1;
      pointer.y = -((clientY - rect.top) / rect.height) * 2 + 1;
      raycaster.setFromCamera(pointer, camera);

      // near cat detection
      if(catModel){
        const catPos = new THREE.Vector3(); catModel.getWorldPosition(catPos);
        const clickedPoint = new THREE.Vector3();
        raycaster.ray.at(3, clickedPoint); // point along ray
        const dist = clickedPoint.distanceTo(catPos);
        if(dist < 1.5) {
          kittyJump(); // kitty responds
          // keep bubble message as-is
          return;
        }
      }

      // check gift click
      const intersects = raycaster.intersectObjects([box, lid, strip1, strip2], true);
      if(intersects.length){
        if(giftOpened) return;
        attempt++;
        if(attempt === 1){
          showBubble(messages[1]);
          moveGiftTo(0.45, 0.05);
        } else if(attempt === 2){
          showBubble(messages[2]);
          moveGiftTo(0.0, 0.18);
        } else {
          giftOpened = true;
          openGiftSequence();
        }
      }
    }
    renderer.domElement.addEventListener('pointerdown', onPointerDown, {passive:true});

    function moveGiftTo(x,z){
      const start = {x: giftGroup.position.x, z: giftGroup.position.z};
      const to = {x, z};
      const t0 = performance.now(), dur = 420;
      function anim(now){
        const t = Math.min(1,(now-t0)/dur);
        const ease = 1 - Math.pow(1 - t, 3);
        giftGroup.position.x = start.x + (to.x - start.x) * ease;
        giftGroup.position.z = start.z + (to.z - start.z) * ease;
        if(t<1) requestAnimationFrame(anim);
      }
      requestAnimationFrame(anim);
      box.material.emissive = new THREE.Color(0xffe0f0);
      setTimeout(()=> box.material.emissive.setHex(0x000000), 350);
    }

    function openGiftSequence(){
      // animate lid open
      const start = performance.now(), dur=420;
      const base = lid.rotation.x;
      (function animateLid(now){
        const p = Math.min(1,(now-start)/dur);
        lid.rotation.x = base - (Math.PI/2) * (1 - Math.pow(1 - p, 2));
        if(p<1) requestAnimationFrame(animateLid);
      })(performance.now());

      // sequence messages
      let idx = 3;
      function next(){
        if(idx > 5){
          // show Go button near bubble
          showGoButton();
          return;
        }
        showBubble(messages[idx]);
        // kitty expression + jump
        kittyJump();
        idx++;
        // keep each message visible longer so phone users can read
        setTimeout(next, 1800);
      }
      setTimeout(next, 700);
    }

    function showGoButton(){
      const wrap = document.getElementById('wrap');
      const a = document.createElement('a');
      a.className = 'go-btn';
      a.href = 'index.html';
      a.innerText = 'Go to your surprise ‚ú®';
      a.style.position = 'absolute';
      // place under bubble
      const bl = parseFloat(bubble.style.left || 16);
      const bt = parseFloat(bubble.style.top || 80);
      a.style.left = bl + 'px';
      a.style.top = (bt + bubble.offsetHeight + 10) + 'px';
      a.style.zIndex = 90;
      wrap.appendChild(a);
    }

    // show initial bubble
    showBubble(messages[0]);

    // renderer loop; responsive handling
    function animate(){
      requestAnimationFrame(animate);
      const dt = clock.getDelta ? clock.getDelta() : 0.016;
      if(mixer) mixer.update(dt);
      // idle motion
      const t = performance.now()*0.001;
      if(catGroup) { catGroup.rotation.y = Math.sin(t*0.4)*0.02; catGroup.position.y = Math.sin(t*1.1)*0.008; }
      // resize renderer to fit holder
      const holder = document.getElementById('canvas-holder');
      const rect = holder.getBoundingClientRect();
      const w = Math.max(16, Math.floor(rect.width));
      const h = Math.max(16, Math.floor(rect.height));
      if(renderer.domElement.width !== w * devicePixelRatio || renderer.domElement.height !== h * devicePixelRatio){
        renderer.setSize(w, h, false);
        camera.aspect = w/h; camera.updateProjectionMatrix();
      }
      positionBubbleAboveCat();
      renderer.render(scene, camera);
    }
    animate();

    // initial size adjust
    function initialResize(){ const holder = document.getElementById('canvas-holder'); const r=holder.getBoundingClientRect(); renderer.setSize(r.width, r.height, false); camera.aspect = r.width / r.height; camera.updateProjectionMatrix();}
    setTimeout(initialResize, 120);
    window.addEventListener('resize', initialResize);
  </script>
</body>
</html>
