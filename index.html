<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>For Arhaan - The Gift (Black & Gold Theme)</title>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

    <link rel="stylesheet" href="realism_enhancements.css">

Â  Â  <style>
Â  Â  Â  Â  /* ================================================= */
Â  Â  Â  Â  /* ğŸŒŸ CSS THEME UPDATE: BLACK & GOLD ACCENTS ğŸŒŸ */
Â  Â  Â  Â  /* ================================================= */
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  font-family: 'Poppins', sans-serif;
Â  Â  Â  Â  Â  Â  color: #E6E6E6; /* Light gray text on dark background */
Â  Â  Â  Â  Â  Â  /* ğŸŒŸ Deep Black background ğŸŒŸ */
Â  Â  Â  Â  Â  Â  background-color: #0A0A0A; 
Â  Â  Â  Â  Â  Â  overflow: hidden; 
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  min-height: 100vh;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* 3D CANVAS STYLES */
Â  Â  Â  Â  canvas {
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  Â  Â  width: 100% !important;
Â  Â  Â  Â  Â  Â  height: 100% !important;
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  z-index: 1;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* UI CONTAINER */
Â  Â  Â  Â  #ui-overlay {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  justify-content: flex-end;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  pointer-events: none;
Â  Â  Â  Â  Â  Â  padding-bottom: 50px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* SPEECH BUBBLE STYLES - UPDATED FOR DARK THEME */
Â  Â  Â  Â  #speech-bubble {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 50%;
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  transform: translate(-50%, -150%);
Â  Â  Â  Â  Â  Â  background-color: #222222; /* Darker background for contrast */
Â  Â  Â  Â  Â  Â  /* ACCENT COLOR: #FFD700 (Gold) */
Â  Â  Â  Â  Â  Â  border: 2px solid #FFD700; 
Â  Â  Â  Â  Â  Â  color: #FFD700; /* Gold text */
Â  Â  Â  Â  Â  Â  padding: 10px 15px;
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  Â  Â  font-size: clamp(14px, 4vw, 20px);
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  transition: opacity 0.5s, transform 0.2s;
Â  Â  Â  Â  Â  Â  max-width: 80%;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  pointer-events: none;
Â  Â  Â  Â  Â  Â  z-index: 20;
Â  Â  Â  Â  }

Â  Â  Â  Â  #speech-bubble.visible {
Â  Â  Â  Â  Â  Â  opacity: 1;
Â  Â  Â  Â  Â  Â  transform: translate(-50%, -150%) scale(1);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* BUTTON STYLES - UPDATED FOR GOLD ACCENT */
Â  Â  Â  Â  .surprise-button {
Â  Â  Â  Â  Â  Â  /* ACCENT COLOR: #FFD700 (Gold) */
Â  Â  Â  Â  Â  Â  background-color: #FFD700;
Â  Â  Â  Â  Â  Â  color: #0A0A0A; /* Dark text on gold button */
Â  Â  Â  Â  Â  Â  padding: 15px 30px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 30px;
Â  Â  Â  Â  Â  Â  font-size: 1.2rem;
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  box-shadow: 0 8px 15px rgba(255, 215, 0, 0.4);
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  Â  Â  Â  pointer-events: all; 
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  transform: translateY(20px);
Â  Â  Â  Â  }

Â  Â  Â  Â  .surprise-button:hover {
Â  Â  Â  Â  Â  Â  background-color: #F8C300; /* Slightly darker gold on hover */
Â  Â  Â  Â  Â  Â  box-shadow: 0 10px 20px rgba(255, 215, 0, 0.6);
Â  Â  Â  Â  Â  Â  transform: translateY(-2px);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* GLOW EFFECT ANIMATION - UPDATED FOR GOLD GLOW */
Â  Â  Â  Â  .glowing-button {
Â  Â  Â  Â  Â  Â  animation: glow 1.5s infinite alternate;
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes glow {
Â  Â  Â  Â  Â  Â  from {
Â  Â  Â  Â  Â  Â  Â  Â  box-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px #FFD700, 0 0 20px #FFD700;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  to {
Â  Â  Â  Â  Â  Â  Â  Â  box-shadow: 0 0 10px #fff, 0 0 20px #fff, 0 0 30px #FFD700, 0 0 40px #FFD700;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <div id="container"></div>
Â  Â  <div id="ui-overlay">
Â  Â  Â  Â  <div id="speech-bubble"></div>
Â  Â  Â  Â  <button id="surprise-btn" class="surprise-button" onclick="window.location.href='birthday.html'">
Â  Â  Â  Â  Â  Â  ğŸ‘‰ Go to your surprise âœ¨
Â  Â  Â  Â  </button>
Â  Â  </div>

Â  Â  <script>
Â  Â  // =================================================
Â  Â  // ğŸŒŸ JAVASCRIPT / THREE.JS UPDATES ğŸŒŸ
Â  Â  // =================================================

Â  Â  // --- CONFIGURATION ---
Â  Â  const CAT_MODEL_URL = 'cute_spooky_cat.glb'; 
Â  Â  const MEOW_SOUND_URL = 'meow.mp3'; 
Â  Â  
Â  Â  // ğŸŒŸ UPDATED GIFT COLOR: Vibrant Red ğŸŒŸ
Â  Â  const GIFT_COLOR = 0xC91D34; // Vibrant Red 
Â  Â  
Â  Â  const STAR_COLOR = 0xffe08c; // Light Gold/Yellow for sparkles

Â  Â  // Text sequence (UNCHANGED)
Â  Â  const textSequence = [
Â  Â  Â  Â  'Hereâ€™s something special for you â€” click here ğŸ',
Â  Â  Â  Â  'Oops, you missed it! Try again meri jaan ğŸ’‹',
Â  Â  Â  Â  'Okay okay, now itâ€™s final â€” click here ğŸ˜œ',
Â  Â  Â  Â  'I am the gift! What else do you want, another woman? ğŸ•µï¸â€â™€ï¸ğŸ˜',
Â  Â  Â  Â  'Ahh, you couldnâ€™t have another woman, so itâ€™s me ğŸ˜ğŸ’–',
Â  Â  Â  Â  'After all the fun... hereâ€™s your birthday wish ğŸ‚' 
Â  Â  ];
Â  Â  
Â  Â  // --- THREE.JS SCENE SETUP ---
Â  Â  let scene, camera, renderer, cat, gift, mixer, clock, catMixer, catAction;
Â  Â  let particles; 
Â  Â  let step = 0; 
Â  Â  let bubble = document.getElementById('speech-bubble');
Â  Â  let surpriseBtn = document.getElementById('surprise-btn');
Â  Â  let meowSound;
Â  Â  
Â  Â  // Initial 3D positions (UNCHANGED)
Â  Â  const INITIAL_CAT_POS = { x: -1.2, y: 0, z: 0 };
Â  Â  const INITIAL_GIFT_POS = { x: 1.5, y: 0, z: 0 };
Â  Â  const CENTRAL_GIFT_POS = { x: 0, y: 0, z: 0.5 };

Â  Â  // Initialize scene, camera, and renderer
Â  Â  function init() {
Â  Â  Â  Â  const container = document.getElementById('container');
Â  Â  Â  Â  
Â  Â  Â  Â  // Scene & Camera & Renderer 
Â  Â  Â  Â  scene = new THREE.Scene();
Â  Â  Â  Â  scene.background = new THREE.Color(0x0a0a0a); 
Â  Â  Â  Â  
Â  Â  Â  Â  camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
Â  Â  Â  Â  camera.position.set(0, 1.5, 3.5);
Â  Â  Â  Â  
Â  Â  Â  Â  // ğŸŒŸ IMPORTANT: Enable physically correct lighting for realism ğŸŒŸ
Â  Â  Â  Â  renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
Â  Â  Â  Â  renderer.setSize(window.innerWidth, window.innerHeight);
Â  Â  Â  Â  renderer.setPixelRatio(window.devicePixelRatio);
Â  Â  Â  Â  renderer.shadowMap.enabled = true;
Â  Â  Â  Â  renderer.toneMapping = THREE.ACESFilmicToneMapping; // Add tone mapping for better contrast
Â  Â  Â  Â  renderer.toneMappingExposure = 1.2; // Increase exposure slightly
Â  Â  Â  Â  container.appendChild(renderer.domElement);
Â  Â  Â  Â  
Â  Â  Â  Â  // Audio setup (UNCHANGED)
Â  Â  Â  Â  const listener = new THREE.AudioListener();
Â  Â  Â  Â  camera.add(listener);
Â  Â  Â  Â  meowSound = new THREE.PositionalAudio(listener);
Â  Â  Â  Â  const audioLoader = new THREE.AudioLoader();
Â  Â  Â  Â  audioLoader.load(MEOW_SOUND_URL, function(buffer) {
Â  Â  Â  Â  Â  Â  meowSound.setBuffer(buffer);
Â  Â  Â  Â  Â  Â  meowSound.setRefDistance(1);
Â  Â  Â  Â  });

Â  Â  Â  Â  // Lighting setup - Adjusted for a darker scene
Â  Â  Â  Â  // Ambient Light is crucial for PBR materials to work in shadows
Â  Â  Â  Â  const ambientLight = new THREE.AmbientLight(0xffffff, 0.8); // Increased ambient light for PBR
Â  Â  Â  Â  scene.add(ambientLight);
Â  Â  Â  Â  const directionalLight = new THREE.DirectionalLight(0xffffff, 3); // Brighter directional light
Â  Â  Â  Â  directionalLight.position.set(5, 5, 5);
Â  Â  Â  Â  directionalLight.castShadow = true;
Â  Â  Â  Â  directionalLight.shadow.mapSize.width = 1024;
Â  Â  Â  Â  directionalLight.shadow.mapSize.height = 1024;
Â  Â  Â  Â  directionalLight.shadow.camera.near = 0.5;
Â  Â  Â  Â  directionalLight.shadow.camera.far = 50;
Â  Â  Â  Â  scene.add(directionalLight);
Â  Â  Â  Â  
Â  Â  Â  Â  // Ground setup - Making the ground black
Â  Â  Â  Â  const groundGeometry = new THREE.PlaneGeometry(10, 10);
Â  Â  Â  Â  const groundMaterial = new THREE.MeshPhongMaterial({ color: 0x0a0a0a, side: THREE.DoubleSide, shininess: 0 }); 
Â  Â  Â  Â  const ground = new THREE.Mesh(groundGeometry, groundMaterial);
Â  Â  Â  Â  ground.rotation.x = Math.PI / 2;
Â  Â  Â  Â  ground.position.y = 0;
Â  Â  Â  Â  ground.receiveShadow = true;
Â  Â  Â  Â  scene.add(ground);
Â  Â  Â  Â  
Â  Â  Â  Â  // --- Particle functions ---
Â  Â  Â  Â  function createStarTexture() {
Â  Â  Â  Â  Â  Â  const canvas = document.createElement('canvas');
Â  Â  Â  Â  Â  Â  canvas.width = 32;
Â  Â  Â  Â  Â  Â  canvas.height = 32;
Â  Â  Â  Â  Â  Â  const context = canvas.getContext('2d');
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const gradient = context.createRadialGradient(
Â  Â  Â  Â  Â  Â  Â  Â  canvas.width / 2, canvas.height / 2, 0, 
Â  Â  Â  Â  Â  Â  Â  Â  canvas.width / 2, canvas.height / 2, canvas.width / 2
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  gradient.addColorStop(0, 'rgba(255, 255, 255, 1)'); 
Â  Â  Â  Â  Â  Â  gradient.addColorStop(0.5, 'rgba(255, 255, 255, 0.5)'); 
Â  Â  Â  Â  Â  Â  gradient.addColorStop(1, 'rgba(0, 0, 0, 0)'); 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  context.fillStyle = gradient;
Â  Â  Â  Â  Â  Â  context.fillRect(0, 0, canvas.width, canvas.height);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  return new THREE.CanvasTexture(canvas);
Â  Â  Â  Â  }

Â  Â  Â  Â  function createParticles() {
Â  Â  Â  Â  Â  Â  const geometry = new THREE.BufferGeometry();
Â  Â  Â  Â  Â  Â  const count = 500; 

Â  Â  Â  Â  Â  Â  const positions = new Float32Array(count * 3);
Â  Â  Â  Â  Â  Â  const colors = new Float32Array(count * 3);
Â  Â  Â  Â  Â  Â  const sizes = new Float32Array(count);

Â  Â  Â  Â  Â  Â  const color = new THREE.Color(STAR_COLOR);

Â  Â  Â  Â  Â  Â  for (let i = 0; i < count; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  positions[i * 3 + 0] = (Math.random() - 0.5) * 20;
Â  Â  Â  Â  Â  Â  Â  Â  positions[i * 3 + 1] = (Math.random() - 0.5) * 10 + 5;
Â  Â  Â  Â  Â  Â  Â  Â  positions[i * 3 + 2] = (Math.random() - 0.5) * 20 - 5; 
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  colors[i * 3 + 0] = color.r;
Â  Â  Â  Â  Â  Â  Â  Â  colors[i * 3 + 1] = color.g;
Â  Â  Â  Â  Â  Â  Â  Â  colors[i * 3 + 2] = color.b;
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  sizes[i] = Math.random() * 0.2 + 0.1; 
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
Â  Â  Â  Â  Â  Â  geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
Â  Â  Â  Â  Â  Â  geometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1));
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const particleTexture = createStarTexture(); 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const material = new THREE.PointsMaterial({
Â  Â  Â  Â  Â  Â  Â  Â  size: 0.2, 
Â  Â  Â  Â  Â  Â  Â  Â  vertexColors: true,
Â  Â  Â  Â  Â  Â  Â  Â  blending: THREE.AdditiveBlending, 
Â  Â  Â  Â  Â  Â  Â  Â  transparent: true,
Â  Â  Â  Â  Â  Â  Â  Â  sizeAttenuation: true,
Â  Â  Â  Â  Â  Â  Â  Â  opacity: 1, 
Â  Â  Â  Â  Â  Â  Â  Â  map: particleTexture, 
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  particles = new THREE.Points(geometry, material);
Â  Â  Â  Â  Â  Â  scene.add(particles);
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  createParticles();

Â  Â  Â  Â  // Load Gift Box (Material changed to MeshStandardMaterial for realism)
Â  Â  Â  Â  function loadGiftBox() {
Â  Â  Â  Â  Â  Â  const boxSize = 1;
Â  Â  Â  Â  Â  Â  const giftBox = new THREE.Group();
Â  Â  Â  Â  Â  Â  const boxGeometry = new THREE.BoxGeometry(boxSize, boxSize * 0.8, boxSize);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // ğŸŒŸ THE REALISM FIX: Use MeshStandardMaterial ğŸŒŸ
Â  Â  Â  Â  Â  Â  const boxMaterial = new THREE.MeshStandardMaterial({ 
Â  Â  Â  Â  Â  Â  Â  Â  color: GIFT_COLOR, 
Â  Â  Â  Â  Â  Â  Â  Â  metalness: 0.9, // Almost pure metal
Â  Â  Â  Â  Â  Â  Â  Â  roughness: 0.3, // Semi-polished surface (0=mirror, 1=matte)
Â  Â  Â  Â  Â  Â  }); 

Â  Â  Â  Â  Â  Â  const boxMesh = new THREE.Mesh(boxGeometry, boxMaterial);
Â  Â  Â  Â  Â  Â  boxMesh.position.y = boxSize * 0.4;
Â  Â  Â  Â  Â  Â  boxMesh.castShadow = true;
Â  Â  Â  Â  Â  Â  giftBox.add(boxMesh);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Ribbon and Bow meshes (Also updated to MeshStandardMaterial)
Â  Â  Â  Â  Â  Â  const ribbonMaterial = new THREE.MeshStandardMaterial({ 
Â  Â  Â  Â  Â  Â  Â  Â  color: 0xcccccc, 
Â  Â  Â  Â  Â  Â  Â  Â  metalness: 0.1, // Not metal
Â  Â  Â  Â  Â  Â  Â  Â  roughness: 0.8, // Matte, soft fabric look
Â  Â  Â  Â  Â  Â  }); 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const ribbonThin = new THREE.BoxGeometry(boxSize + 0.02, 0.05, 0.1);
Â  Â  Â  Â  Â  Â  const ribbonWide = new THREE.BoxGeometry(0.1, 0.05, boxSize + 0.02);
Â  Â  Â  Â  Â  Â  const ribbonH = new THREE.Mesh(ribbonThin, ribbonMaterial);
Â  Â  Â  Â  Â  Â  ribbonH.position.y = boxSize * 0.8 + 0.025;
Â  Â  Â  Â  Â  Â  ribbonH.castShadow = true;
Â  Â  Â  Â  Â  Â  giftBox.add(ribbonH);
Â  Â  Â  Â  Â  Â  const ribbonV = new THREE.Mesh(ribbonWide, ribbonMaterial);
Â  Â  Â  Â  Â  Â  ribbonV.position.y = boxSize * 0.8 + 0.025;
Â  Â  Â  Â  Â  Â  ribbonV.castShadow = true;
Â  Â  Â  Â  Â  Â  giftBox.add(ribbonV);
Â  Â  Â  Â  Â  Â  const bowGeometry = new THREE.SphereGeometry(0.15, 16, 16);
Â  Â  Â  Â  Â  Â  const bowMesh = new THREE.Mesh(bowGeometry, ribbonMaterial);
Â  Â  Â  Â  Â  Â  bowMesh.position.y = boxSize * 0.8 + 0.15;
Â  Â  Â  Â  Â  Â  bowMesh.castShadow = true;
Â  Â  Â  Â  Â  Â  giftBox.add(bowMesh);

Â  Â  Â  Â  Â  Â  giftBox.position.set(INITIAL_GIFT_POS.x, INITIAL_GIFT_POS.y, INITIAL_GIFT_POS.z); 
Â  Â  Â  Â  Â  Â  scene.add(giftBox);
Â  Â  Â  Â  Â  Â  gift = giftBox;
Â  Â  Â  Â  }

Â  Â  Â  Â  loadGiftBox();

Â  Â  Â  Â  // Load Cat Model (UNCHANGED)
Â  Â  Â  Â  const loader = new THREE.GLTFLoader();
Â  Â  Â  Â  loader.load(CAT_MODEL_URL, function(gltf) {
Â  Â  Â  Â  Â  Â  cat = gltf.scene;
Â  Â  Â  Â  Â  Â  cat.position.set(INITIAL_CAT_POS.x, INITIAL_CAT_POS.y, INITIAL_CAT_POS.z);
Â  Â  Â  Â  Â  Â  cat.scale.set(0.8, 0.8, 0.8);
Â  Â  Â  Â  Â  Â  cat.traverse(function(node) {
Â  Â  Â  Â  Â  Â  Â  Â  if (node.isMesh) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  node.castShadow = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  node.receiveShadow = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Also ensure the cat material is compatible with PBR lighting
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (node.material && node.material.isMeshPhongMaterial) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  node.material = new THREE.MeshStandardMaterial().copy(node.material);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  cat.add(meowSound);
Â  Â  Â  Â  Â  Â  scene.add(cat);
Â  Â  Â  Â  Â  Â  if (gltf.animations && gltf.animations.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  catMixer = new THREE.AnimationMixer(cat);
Â  Â  Â  Â  Â  Â  Â  Â  catAction = catMixer.clipAction(gltf.animations[0]);
Â  Â  Â  Â  Â  Â  Â  Â  catAction.play();
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Initial bubble message
Â  Â  Â  Â  Â  Â  updateBubbleText(textSequence[step]);
Â  Â  Â  Â  Â  Â  step++;

Â  Â  Â  Â  }, undefined, function(error) {
Â  Â  Â  Â  Â  Â  console.error('An error happened loading the cat model:', error);
Â  Â  Â  Â  Â  Â  updateBubbleText(textSequence[step]);
Â  Â  Â  Â  Â  Â  step++;
Â  Â  Â  Â  });

Â  Â  Â  Â  clock = new THREE.Clock();
Â  Â  Â  Â  window.addEventListener('resize', onWindowResize, false);
Â  Â  }

Â  Â  function onWindowResize() {
Â  Â  Â  Â  camera.aspect = window.innerWidth / window.innerHeight;
Â  Â  Â  Â  camera.updateProjectionMatrix();
Â  Â  Â  Â  renderer.setSize(window.innerWidth, window.innerHeight);
Â  Â  }

Â  Â  // Animation Loop
Â  Â  function animate() {
Â  Â  Â  Â  requestAnimationFrame(animate);

Â  Â  Â  Â  const delta = clock.getDelta();

Â  Â  Â  Â  if (catMixer) {
Â  Â  Â  Â  Â  Â  catMixer.update(delta);
Â  Â  Â  Â  }

Â  Â  Â  Â  // Gift Idle Animation 
Â  Â  Â  Â  if (gift && !TWEEN.getAll().some(t => t.object === gift.position)) {
Â  Â  Â  Â  Â  Â  const time = clock.getElapsedTime();
Â  Â  Â  Â  Â  Â  gift.rotation.y = Math.sin(time * 0.5) * 0.1;
Â  Â  Â  Â  Â  Â  const basePosition = (step > 1) ? CENTRAL_GIFT_POS : INITIAL_GIFT_POS;
Â  Â  Â  Â  Â  Â  gift.position.y = basePosition.y + Math.sin(time * 2) * 0.05;
Â  Â  Â  Â  Â  Â  if (step > 1) {
Â  Â  Â  Â  Â  Â  Â  Â  gift.position.x = basePosition.x;
Â  Â  Â  Â  Â  Â  Â  Â  gift.position.z = basePosition.z;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  if (cat && !catMixer) {
Â  Â  Â  Â  Â  Â  const time = clock.getElapsedTime();
Â  Â  Â  Â  Â  Â  cat.rotation.y = Math.sin(time * 0.3) * 0.05 + Math.PI;
Â  Â  Â  Â  }

Â  Â  Â  Â  // =================================================================
Â  Â  Â  Â  // ğŸŒŸ UPDATED Particle Animation: Fading, Glowing Sparkle Effect with Horizontal Movement ğŸŒŸ
Â  Â  Â  Â  // =================================================================
Â  Â  Â  Â  if (particles) {
Â  Â  Â  Â  Â  Â  const positions = particles.geometry.attributes.position.array;
Â  Â  Â  Â  Â  Â  const time = clock.getElapsedTime();
Â  Â  Â  Â  Â  Â  const speed = 0.01;
Â  Â  Â  Â  Â  Â  const amplitude = 0.015; 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // 1. Global Fading/Glow Effect: Animates the overall particle opacity
Â  Â  Â  Â  Â  Â  // Maps sine wave from [-1, 1] to [0.3, 1] for a subtle, cyclical fade
Â  Â  Â  Â  Â  Â  const glowIntensity = (Math.sin(time * 0.5) * 0.35) + 0.65; 
Â  Â  Â  Â  Â  Â  particles.material.opacity = glowIntensity;

Â  Â  Â  Â  Â  Â  // 2. Individual Sparkle/Twinkle Effect and Movement
Â  Â  Â  Â  Â  Â  for (let i = 0; i < positions.length; i += 3) {
Â  Â  Â  Â  Â  Â  Â  Â  // Vertical movement (upward drift)
Â  Â  Â  Â  Â  Â  Â  Â  positions[i + 1] += speed * delta * (Math.sin(time * 2 + i) * 0.5 + 0.5); 
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Horizontal movement: Slight random drift based on sine wave
Â  Â  Â  Â  Â  Â  Â  Â  positions[i + 0] += Math.sin(time * 1.5 + i) * 0.005 * delta; // X-axis drift
Â  Â  Â  Â  Â  Â  Â  Â  positions[i + 2] += Math.cos(time * 1.5 + i) * 0.005 * delta; // Z-axis drift
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Size update (individual sparkle/twinkle effect)
Â  Â  Â  Â  Â  Â  Â  Â  const sizeAttribute = particles.geometry.attributes.size;
Â  Â  Â  Â  Â  Â  Â  Â  // Use a faster sine wave (time * 12) for a more noticeable twinkle
Â  Â  Â  Â  Â  Â  Â  Â  const twinklePulse = (Math.sin(time * 12 + i / 3) * amplitude * 2) + 0.15;
Â  Â  Â  Â  Â  Â  Â  Â  sizeAttribute.array[i / 3] = twinklePulse * 2;
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Reset particle position if it moves too high (looping effect)
Â  Â  Â  Â  Â  Â  Â  Â  if (positions[i + 1] > 10) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  positions[i + 1] = -5;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  particles.geometry.attributes.position.needsUpdate = true;
Â  Â  Â  Â  Â  Â  particles.geometry.attributes.size.needsUpdate = true;
Â  Â  Â  Â  }

Â  Â  Â  Â  renderer.render(scene, camera);
Â  Â  }

Â  Â  // --- INTERACTION LOGIC (UNCHANGED) ---

Â  Â  function updateBubbleText(text) {
Â  Â  Â  Â  bubble.innerHTML = text;
Â  Â  Â  Â  bubble.classList.add('visible');
Â  Â  }

Â  Â  function playCatMeowAndJump() {
Â  Â  Â  Â  if (meowSound && meowSound.buffer && !meowSound.isPlaying) {
Â  Â  Â  Â  Â  Â  meowSound.play();
Â  Â  Â  Â  }

Â  Â  Â  Â  if (cat) {
Â  Â  Â  Â  Â  Â  // Cat Jump animation
Â  Â  Â  Â  Â  Â  new TWEEN.Tween(cat.position)
Â  Â  Â  Â  Â  Â  Â  Â  .to({ y: 0.3 }, 150)
Â  Â  Â  Â  Â  Â  Â  Â  .easing(TWEEN.Easing.Quadratic.Out)
Â  Â  Â  Â  Â  Â  Â  Â  .chain(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  new TWEEN.Tween(cat.position)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .to({ y: 0 }, 150)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .easing(TWEEN.Easing.Quadratic.In)
Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  Â  Â  .start();
Â  Â  Â  Â  }
Â  Â  }
Â  Â  
Â  Â  function moveOrShakeGift() {
Â  Â  Â  Â  if (!gift) return;

Â  Â  Â  Â  if (step === 1) { 
Â  Â  Â  Â  Â  Â  // First actual click (when showing the 2nd message) - MOVE the gift to the center
Â  Â  Â  Â  Â  Â  new TWEEN.Tween(gift.position)
Â  Â  Â  Â  Â  Â  Â  Â  .to(CENTRAL_GIFT_POS, 800) 
Â  Â  Â  Â  Â  Â  Â  Â  .easing(TWEEN.Easing.Cubic.Out) 
Â  Â  Â  Â  Â  Â  Â  Â  .start();

Â  Â  Â  Â  Â  Â  // Rotate it as it moves
Â  Â  Â  Â  Â  Â  new TWEEN.Tween(gift.rotation)
Â  Â  Â  Â  Â  Â  Â  Â  .to({ y: gift.rotation.y + Math.PI * 2 }, 800)
Â  Â  Â  Â  Â  Â  Â  Â  .easing(TWEEN.Easing.Cubic.Out)
Â  Â  Â  Â  Â  Â  Â  Â  .start();

Â  Â  Â  Â  } else if (step > 1) {
Â  Â  Â  Â  Â  Â  // Subsequent clicks - do a subtle shake at the center position
Â  Â  Â  Â  Â  Â  new TWEEN.Tween(gift.position)
Â  Â  Â  Â  Â  Â  Â  Â  .to({ x: CENTRAL_GIFT_POS.x + 0.1, y: 0.1, z: CENTRAL_GIFT_POS.z }, 100) 
Â  Â  Â  Â  Â  Â  Â  Â  .easing(TWEEN.Easing.Quadratic.Out)
Â  Â  Â  Â  Â  Â  Â  Â  .chain(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  new TWEEN.Tween(gift.position)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .to({ x: CENTRAL_GIFT_POS.x, y: 0, z: CENTRAL_GIFT_POS.z }, 100) 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .easing(TWEEN.Easing.Quadratic.In)
Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  Â  Â  .start();
Â  Â  Â  Â  }
Â  Â  }


Â  Â  function handleCatClick() {
Â  Â  Â  Â  // Hide the current bubble immediately before showing the new one
Â  Â  Â  Â  bubble.classList.remove('visible');
Â  Â  Â  Â  
Â  Â  Â  Â  // Check if all messages have already been displayed
Â  Â  Â  Â  if (step >= textSequence.length) {
Â  Â  Â  Â  Â  Â  // Keep showing the final message and animations
Â  Â  Â  Â  Â  Â  updateBubbleText(textSequence[textSequence.length - 1]);
Â  Â  Â  Â  Â  Â  playCatMeowAndJump();
Â  Â  Â  Â  Â  Â  moveOrShakeGift(); 
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // Core interaction logic
Â  Â  Â  Â  playCatMeowAndJump();
Â  Â  Â  Â  moveOrShakeGift(); 
Â  Â  Â  Â  
Â  Â  Â  Â  // Delay showing the next message slightly
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â updateBubbleText(textSequence[step]);
Â  Â  Â  Â  Â  Â  Â step++; // Increment step AFTER displaying the message
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â // ** THE CRITICAL FIX IS HERE **
Â  Â  Â  Â  Â  Â  Â // Show the button when step equals the length of the array (meaning the last message has been shown and step was incremented).
Â  Â  Â  Â  Â  Â  Â if (step >= textSequence.length) {
Â  Â  Â  Â  Â  Â  Â  Â  Â surpriseBtn.classList.add('glowing-button');
Â  Â  Â  Â  Â  Â  Â  Â  Â surpriseBtn.style.opacity = 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â surpriseBtn.style.transform = 'translateY(0)';
Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  }, 300); 
Â  Â  }

Â  Â  // TWEEN.js initialization (UNCHANGED)
Â  Â  const tweenScript = document.createElement('script');
Â  Â  tweenScript.src = "https://cdn.jsdelivr.net/npm/@tweenjs/tween.js@18.6.4/dist/tween.umd.js";
Â  Â  tweenScript.onload = () => {
Â  Â  Â  Â  function animateTWEEN(time) {
Â  Â  Â  Â  Â  Â  requestAnimationFrame(animateTWEEN);
Â  Â  Â  Â  Â  Â  TWEEN.update(time);
Â  Â  Â  Â  }
Â  Â  Â  Â  animateTWEEN();
Â  Â  Â  Â  init(); 
Â  Â  Â  Â  animate();
Â  Â  Â  Â  
Â  Â  Â  Â  // Set up click listener on the whole canvas area
Â  Â  Â  Â  renderer.domElement.addEventListener('click', handleCatClick, false);
Â  Â  Â  Â  // Initial call to show the first message
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â bubble.classList.add('visible');
Â  Â  Â  Â  }, 500);
Â  Â  };
Â  Â  document.head.appendChild(tweenScript);

</script>
</body>
</html>
